const mysql = require("mysql");
const winston = require("winston");

class Database {
    connect() {
        return new Promise((resolve, reject) => {
            this.connection = mysql.createConnection({host: "localhost", user: "cloud", password: "scape", database: "brint" });
            this.connection.connect();
            resolve(true);
        });
    }

    query(id, rowCallback, finalCallback) {
        // const erroredIds = [8,9,10,11,24,25,27,28,31,36,37,39,40,41,42,44,48,49,50,52,53,54,57,79,128,141,142,146,149,154,159,168,179,180,182,184,185,192,195,206,212,219,275,280,281,282,283,284,286,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,312,314,316,319,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,348,350,352,353,354,355,356,357,359,360,361,362,363,364,365,366,367,368,369,371,372,373,374,375,376,377,378,379,380,381,382,383,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,433,434,448,460,462,466,468,469,470,471,472,473,474,475,476,477,478,479,480,482,483,485,489,490,548,549,551,552,553,556,557,558,560,561,563,564,566,567,568,570,571,572,574,575,576,578,579,580,581,582,583,587,588,591,592,594,595,596,597,599,600,601,602,603,604,605,606,607,609,610,611,613,614,615,616,617,618,619,620,622,623,624,627,628,629,630,631,632,633,635,636,637,638,639,640,642,643,644,645,646,647,648,650,652,654,656,657,658,659,660,661,662,663,664,665,666,667,668,669,670,671,673,675,677,679,680,681,683,685,686,687,688,690,691,692,693,694,695,696,698,699,700,701,703,704,710,712,713,714,715,716,718,719,720,733,735,736,737,740,741,743,744,745,746,748,749,753,754,755,805,807,808,810,811,812,813,814,815,816,817,818,820,821,822,823,828,829,830,831,832,833,835,836,837,847,848,851,856,857,858,863,866,872,880,882,891,892,916,917,932,933,936,937,938,939,940,941,942,944,946,983,989,991,1006,1009,1010,1011,1130,1131,1132,1133,1259,1325,1331,1332,1333,1335,1336,1337,1338,1339,1340,1341,1342,1343,1345,1346,1347,1348,1349,1350,1351,1352,1354,1355,1356,1357,1358,1359,1361,1362,1363,1364,1365,1366,1367,1368,1369,1370,1371,1372,1373,1376,1377,1381,1382,1383,1384,1388,1389,1410,1411,1412,1413,1414,1415,1425,1439,1453,1454,1490,1492,1510,1513,1515,1524,1529,1569,1588,1589,1603,1604,1608,1610,1612,1621,1631,1641,1642,1644,1648,1649,1650,1657,1661,1663,1672,1681,1682,1693,1699,1710,1715,1718,1719,1721,1728,1734,1735,1741,1746,1749,1750,1751,1753,1755,1757,1759,1760,1761,1762,1763,1782,1783,1785,1786,1787,1788,1789,1790,1791,1793,1795,1796,1817,1827,1833,1835,1839,1847,1856,1857,1862,1876,1891,1892,1894,1895,1896,1897,1900,1901,1904,1917,1928,1952,1986,1994,1995,1999,2000,2004,2007,2008,2010,2011,2012,2016,2017,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2031,2032,2033,2034,2035,2036,2037,2038,2039,2040,2041,2043,2044,2046,2051,2055,2056,2057,2059,2081,2095,2096,2097,2098,2100,2101,2102,2103,2104,2105,2106,2107,2108,2109,2110,2111,2124,2125,2129,2140,2144,2146,2153,2185,2190,2191,2192,2202,2206,2207,2208,2209,2210,2211,2221,2267,2277,2291,2292,2299,2317,2324,2327,2330,2332,2334,2337,2339,2344,2346,2347,2348,2349,2352,2353,2355,2357,2358,2359,2362,2364,2443,2444,2446,2447,2448,2450,2452,2453,2454,2455,2488,2490,2561,2567,2572,2573,2583,2586,2588,2589,2593,2594,2595,2596,2597,2598,2599,2600,2645,2658,2660,2710,2713,2717,2721,2744,2745,2746,2747,2748,2749,2753,2754,2770,2771,2772,2773,2782,2787,2800,2802,2820,2840,2850,2894,2898,2900,2901,2907,2917,2945,2953,2956,2959,2965,2974,2978,2986,2993,2994,2995,2996,2997,2998,3002,3009,3022,3026,3028,3029,3030,3031,3036,3042,3043,3044,3047,3068,3075,3082,3083,3093,3113,3164,3199,3244,3253,3291,3292,3293,3294,3295,3296,3297,3298,3299,3300,3301,3302,3303,3304,3305,3318,3325,3333,3334,3335,3336,3384,3385,3389,3395,3396,3397,3399,3402,3410,3411,3431,3435,3455,3456,3465,3466,3467,3468,3469,3472,3491,3499,3503,3515,3518,3522,3532,3538,3550,3552,3553,3573,3574,3575,3576,3577,3578,3580,3582,3583,3584,3586,3590,3594,3595,3596,3597,3598,3599,3600,3602,3603,3604,3605,3606,3655,3665,3666,3672,3681,3682,3685,3699,3703,3708,3715,3718,3725,3731,3732,3734,3739,3742,3743,3747,3748,3750,3756,3779,3788,3805,3806,3807,3808,3809,3821,3826,3832,3888,3896,3926,3927,3936,3948,3951,3957,3999,4013,4015,4025,4026,4027,4049,4051,4059,4092,4118,4122,4123,4124,4125,4126,4141,4150,4156,4157,4177,4183,4212,4213,4214,4215,4216,4217,4218,4219,4235,4250,4251,4252,4260,4262,4280,4354,4368,4394,4443,4492,4512,4568,4570,4571,4581,4586,4592,4593,4603,4606,4647,4650,4670,4677,4682,4683,4684,4685,4731,4743,4746,4748,4753,4756,4758,4759,4763,4811,4815,4816,4817,4818,4819,4820,4821,4822,4823,4824,4825,4836,4838,4839,4840,4841,4845,4862,4866,4893,4907,4919,4923,4927,4928,4930,4931,4932,4933,4935,4936,4939,4940,4958,4960,4961,4962,4963,4964,4965,4966,4967,4968,4983,4988,4991,4992,4993,4996,4997,4998,4999,5000,5018,5053,5054,5055,5059,5108,5150,5152,5153,5154,5158,5161,5162,5169,5173,5176,5177,5178,5182,5185,5186,5188,5191,5205,5206,5207,5208,5209,5213,5214,5215,5216,5221,5223,5224,5225,5227,5228,5229,5230,5231,5236,5309,5310,5317,5320,5326,5342,5413,5415,5424,5425,5426,5427,5428,5429,5430,5431,5432,5435,5436,5437,5438,5439,5447,5449,5450,5455,5456,5457,5458,5459,5460,5461,5489,5535,5536,5537,5538,5539,5540,5541,5542,5543,5544,5545,5546,5547,5548,5549,5550,5556,5558,5559,5562,5563,5565,5568,5569,5571,5572,5573,5574,5575,5576,5577,5578,5579,5580,5581,5582,5583,5584,5585,5586,5628,5643,5644,5645,5646,5647,5648,5649,5650,5651,5652,5653,5654,5655,5656,5657,5658,5659,5679,5680,5682,5683,5684,5685,5686,5688,5697,5698,5700,5703,5704,5717,5746,5747,5748,5758,5759,5760,5761,5762,5766,5767,5783,5784,5786,5787,5788,5796,5801,5802,5803,5804,5805,5807,5809,5810,5812,5813,5814,5815,5817,5819,5824,5825,5831,5833,5842,5846,5847,5849,5852,5853,5874,5890,5910,5912,5915,5917,5918,5923,5925,5941,6044,6047,6056,6057,6063,6065,6067,6069,6071,6073,6077,6078,6150,6159,6164,6165,6168,6169,6185,6213,6214,6215,6216,6217,6218,6220,6221,6225,6230,6233,6237,6239,6242,6250,6251,6256,6259,6281,6308,6309,6310,6311,6312,6313,6314,6315,6316,6317,6318,6319,6320,6321,6322,6334,6366,6378,6383,6404,6485,6487,6489,6493,6495,6496,6497,6500,6505,6599,6634,6636,6637,6673,6694,6713,6714,6749,6755,6757,6758,6760,6761,6762,6763,6764,6778,6804,6812,6825,6830,6834,6845,6846,6847,6853,6869,6870,6871,6872,6873,6874,6876,6878,6880,6882,6884,6885,6888,6889,6892,6894,6895,6896,6897,6898,6906,6939,6941,6951,6952,6958,6963,6973,6974,6978,7000,7001,7002,7009,7012,7013,7015,7018,7028,7105,7111,7112,7114,7115,7146,7172,7173,7174,7176,7177,7178,7179,7240,7317,7340,7396,7408,7410,7411,7420,7426,7430,7446,7447,7451,7521,7584,7587,7630,7631,7632,7633,7635,7639,7640,7642,7645,7646,7647,7648,7649,7650,7651,7652,7654,7655,7656,7657,7658,7659,7660,7663,7664,7678,7687,7688,7712,7716,7726,7743,7767,7769,7774,7811,7815,7817,7818,7820,7821,7822,7823,7889,7895,7937,7938,7947,7952,8022,8102,8104,8184,8229,8231,8233,8240,8243,8248,8276,8293,8324,8326,8329,8332,8367,8413,8414,8418,8431,8460,8499,8500,8566,8567,8573,8574,8649,8653,8655,8668,8715,8716,8717,8718,8719,8722,8723,8724,8725,8726,8728,8730,8737,8819,8821,8883,9046,9047,9048,9049,9050,9051,9095,9096,9097,9101,9102,9103,9105,9106,9107,9108,9224,9225,9272,9276,9292,9326,9331,9332,9343,9344,9347,9349,9350,9351,9388,9566,9587,9685,9692,9693,9694,9695,9696,9716,9717,9718,9719,9736,9737,9778,9779,9780,9781,9782,9783,9784,9785,9786,9787,9788,9789,9790,9794,9795,9808,9809,9810,9811,9812,9831,9832,9833,9834,9835,9836,9837,9838,9839,9840,9841,9842,9843,9844,9845,9846,9847,9848,9851,9852,9857,9864,9865,9866,9867,9868,9869,9902,9904,9905,9939,9945,9949,9950,9951,9969,9970,9974,9975,9986,10030,10035,10036,10043,10056,10057,10058,10067,10069,10070,10071,10072,10073,10074,10098,10099,10101,10102,10103,10104,10105,10106,10107,10109,10117,10118,10138,10173,10214,10216,10223,10228,10234,10235,10240,10242,10243,10244,10246,10251,10252,10253,10255,10258,10262,10263,10266,10267,10268,10270,10274,10277,10278,10289,10292,10303,10306,10307,10308,10309,10311,10312,10354,10402,10451,10455,10459,10464,10465,10482,10483,10501,10503,10523,10524,10527,10529,10530,10580,10581,10585,10586,10587,10609,10628,10651,10668,10679,10684,10696,10698,10699,10706,10707,10708,10722,10723,10735,10736,10737,10738,10739,10740,10746,10777,10782,10799,10801,10802,10803,10809,10822,10838,10839,10840,10842,10844,10845,10846,10847,10850,10871,10872,10890,10927,10943,10948,10949,10964,10996,10997,11008,11012,11013,11015,11018,11021,11023,11024,11036,11037,11038,11039,11041,11042,11046,11047,11048,11049,11050,11051,11052,11053,11054,11055,11057,11058,11061,11062,11063,11064,11065,11066,11067,11068,11069,11070,11071,11072,11073,11143,11144,11145,11146,11148,11155,11159,11160,11163,11186,11187,11188,11189,11234,11236,11237,11240,11251,11269,11271,11272,11293,11296,11324,11344,11345,11367,11384,11405,11430,11446,11447,11461,11462,11471,11473,11478,11483,11484,11486,11510,11513,11514,11524,11527,11599,11608,11631,11632,11633,11639,11640,11641,11642,11643,11654,11655,11673,11674,11724,11726,11728,11733,11745,11756,11806,11832,11833,11841,11843,11844,11849,11852,11853,11855,11857,11861,11871,11872,11873,11874,11883,11894,11907,11908,11911,11912,11913,11914,11915,11916,11917,11918,11919,11920,11921,11922,11923,11924,11925,11926,11927,11928,11929,11930,11931,11932,11933,11934,11935,11936,11937,11938,11939,11940,11941,11942,11943,11944,11945,11946,11947,11948,11949,11951,11952,11953,11954,11956,11957,11958,11959,11960,11961,11962,11963,11964,11965,11966,11967,11968,11969,11970,11971,11972,11973,11974,11975,11976,11978,11979,11980,11981,11982,11985,11986,11987,11988,11990,11991,11992,11993,11995,11996,11997,11998,11999,12000,12001,12002,12003,12006,12010,12016,12041,12046,12065,12091,12114,12115,12145,12146,12147,12148,12159,12167,12201,12208,12209,12210,12211,12212,12213,12215,12216,12217,12218,12219,12240,12350,12367,12378,12506,12507,12510,12511,12524,12571,12572,12573,12574,12575,12576,12577,12578,12579,12580,12581,12582,12583,12584,12585,12586,12587,12588,12589,12682,12695,12696,12742,12750,12751,12752,12753,12755,12770,12798,12819,12821,12822,12823,12828,12829,12830,12831,12834,12835,12836,12837,12838,12839,12841,12880,12900,12914,12948,12953,12977,17303,19473,19474,19494,19574,19580,19601,19615,19616,19621,19623,19642,19724,19733,19751,22019,22666,24272,24415,24422,24424,24425,24426,24427,24428,24464,24832,24833,24834,24835,24842,24848,24855,24856,24857,24858,24859,24860,24880,24881,24904,24947,24952,24977,24980,25099,25238,25245,25325,25327,25454,25518,25519,25520,25521,25522,25523,25524,25525,25526,25527,25528,25529,25530,25531,25532,25533,25534,25535,25536,25537,25538,25539,25540,25541,25542,25543,25544,25545,25546,25547,25548,25549,25550,25551,25552,25553,25554,25555,25556,25557,25558,25559,25560,25561,25562,25563,25564,25565,25566,25567,25568,25569,25570,25571,25572,25573,25574,25575,25576,25577,25578,25579,25580,25581,25582,25583,25584,25585,25586,25587,25588,25589,25590,25591,25593,25594,25595,25596,25597,25598,25599,25600,25603,25604,25605,25606,25607,25608,25609,25610,25611,25612,25613,25614,25616,25617,25618,25619,25620,25621,25622,25624,25625,25626,25627,25628,25629,25630,25631,25632,25633,25634,25635,25636,25637,25638,25639,25640,25641,25642,25643,25644,25645,25646,25647,25648,25649,25650,25651,25652,25653,25654,25655,25656,25657,25658,25659,25660,25661,25662,25663,25664,25665,25666,25667,25668,25669,25670,25671,25672,25673,25674,25675,25676,25677,25678,25679,25680,25681,25682,25683,25684,25685,25686,25687,25688,25689,25690,25691,25692,25693,25694,25695,25696,25697,25698,25699,25700,25701,25702,25703,25704,25705,25706,25707,25708,25709,25710,25712,25713,25714,25715,25761,25813,25814,25815,25816,25818,25819,25820,25821,25822,25824,25825,25826,25827,25828,25829,25830,25831,25832,25833,25834,25835,25836,25837,25838,25839,25840,25841,25842,25845,25846,25852,25855,25874,25877,25905,25911,25912,25927,25929,25940,25946,25947,25948,25949,25950,25951,25956,25958,25960,25961,25968,25969,25970,25976,25978,25979,25981,25986,25987,25988,25989,25990,25991,25992,25993,25994,25995,25996,25997,25998,26000,26001,26002,26003,26004,26005,26006,26007,26008,26009,26010,26084,26085,26086,26087,26088,26089,26090,26091,26092,26093,26094,26095,26096,26097,26098,26099,26100,26111,26148,26150,26156,26157,26159,26185,26189,26200,26201,26250,26251,26283,26284,26295,26296,26300,26301,26302,26303,26304,26305,26309,26310,26314,26318,26322,26323,26324,26326,26327,26328,26329,26330,26333,26343,26356,26361,26362,26363,26368,26374,26375,26377,26378,26381,26409,26429,26430,26433,26434,26435,26436,26439,26454,26456,26462];
        const erroredIds = undefined;
        const restrictToIds = id ? [id] : erroredIds;
        let query = "SELECT id, namespace, detail FROM landing_page_data where enabled = 1";
        if (restrictToIds) {
            query = query + ` AND id IN (${restrictToIds.join(", ")})`;
        }
        winston.info("Querying all LPDs using " + query);
        this.connection.query(
            query,
            function(error, dbRows, fields) {
                if (error) {
                    reject(error);
                    throw new Error(error);
                }
                handleQueriedResults(dbRows, rowCallback);
                finalCallback();
            }
        );
    }

    releaseConnection() {
        this.connection.end();
    }
}

const handleQueriedResults = (dbRows, callback) => {
    dbRows.some((xmlRow) => {
        callback(xmlRow);
    });
};

module.exports = Database;